<!-- Trang danh sách khóa học -->
<div class="course-list-container">
  <!-- Header -->
  <div class="course-header">
    <div class="container">
      <div class="header-content">
        <div class="header-text">
          <h1>
            <mat-icon>school</mat-icon>
            Khóa học của tôi
          </h1>
          <p>Quản lý tiến độ học tập và hoàn thành khóa học</p>
        </div>
        <div class="header-actions">
          <button mat-raised-button 
                  color="primary" 
                  (click)="refreshCourses()"
                  [disabled]="loading">
            <mat-icon>refresh</mat-icon>
            Làm mới
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- Loading spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Đang tải danh sách khóa học...</p>
  </div>

  <!-- Main content -->
  <div class="course-content" *ngIf="!loading">
    <div class="container">
      
      <!-- Filters section -->
      <div class="filters-section">
        <mat-card class="filters-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>filter_list</mat-icon>
              Bộ lọc tìm kiếm
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <div class="filters-grid">
              <!-- Search Title -->
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>Tìm kiếm theo tên</mat-label>
                <input matInput 
                       [(ngModel)]="searchTitle"
                       (keyup.enter)="applyFilters()"
                       placeholder="Nhập tên khóa học...">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>

              <!-- Status Learn filter -->
              <mat-form-field appearance="outline">
                <mat-label>Trạng thái học</mat-label>
                <mat-select [(ngModel)]="selectedStatusLearn" 
                           (ngModelChange)="applyFilters()">
                  <mat-option *ngFor="let option of statusLearnOptions" [value]="option.value">
                    {{ option.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- Clear filters button -->
              <div class="filter-actions">
                <button mat-button 
                        color="warn" 
                        (click)="clearFilters()">
                  <mat-icon>clear</mat-icon>
                  Xóa bộ lọc
                </button>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Results summary -->
      <div class="results-summary" *ngIf="myCourses.length > 0">
        <p>
          Hiển thị {{ myCourses.length }} khóa học của tôi
          <span *ngIf="searchTitle || selectedStatusLearn">
            (có áp dụng bộ lọc)
          </span>
        </p>
      </div>

      <!-- My Courses grid (TraineeLecture) -->
      <div class="courses-grid" *ngIf="myCourses.length > 0">
        <mat-card class="course-card trainee-lecture-card" 
                  *ngFor="let course of myCourses; trackBy: trackByTraineeLectureId">
          
          <!-- Course image -->
          <div class="course-image">
            <img src="assets/images/default-course.jpg" 
                 [alt]="course.title"
                 class="course-thumbnail">
            
            <!-- Status badge overlay -->
            <div class="status-learn-badge" 
                 [style.background-color]="getStatusLearnColor(course.statusLearn)">
              {{ getStatusLearnDisplayText(course.statusLearn) }}
            </div>
            
            <!-- Course code badge -->
            <div class="course-code-badge">
              {{ course.courseCode }}
            </div>
          </div>
          
          <mat-card-header>
            <mat-card-title [title]="course.title">{{ course.title }}</mat-card-title>
            <mat-card-subtitle>
              <div class="course-meta">
                <span class="course-name" [title]="course.courseName">
                  <mat-icon>school</mat-icon>
                  {{ course.courseName }}
                </span>
                <span class="created-date">
                  <mat-icon>schedule</mat-icon>
                  {{ formatDate(course.created) }}
                </span>
              </div>
            </mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="course-description-wrapper">
              <p class="course-description" [title]="course.description">{{ course.description }}</p>
            </div>
            
            <!-- Course info grid -->
            <div class="course-info-grid">
              <!-- Course objects -->
              <div class="info-item" *ngIf="course.objects">
                <div class="info-label">
                  <mat-icon>flag</mat-icon>
                  <strong>Mục tiêu:</strong>
                </div>
                <p class="info-content" [title]="course.objects">{{ course.objects }}</p>
              </div>
              
              <!-- Note -->
              <div class="info-item" *ngIf="course.note">
                <div class="info-label">
                  <mat-icon>note</mat-icon>
                  <strong>Ghi chú:</strong>
                </div>
                <p class="info-content" [title]="course.note">{{ course.note }}</p>
              </div>
              
              <!-- Registration status -->
              <div class="info-item registration-status">
                <div class="info-label">
                  <mat-icon>person_check</mat-icon>
                  <strong>Trạng thái:</strong>
                </div>
                <div class="registration-badge" [class.registered]="course.isRegistered">
                  <mat-icon [style.color]="course.isRegistered ? '#4caf50' : '#f44336'">
                    {{ course.isRegistered ? 'check_circle' : 'cancel' }}
                  </mat-icon>
                  <span>{{ course.isRegistered ? 'Đã đăng ký' : 'Chưa đăng ký' }}</span>
                </div>
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <div class="card-actions">
              <button mat-button 
                      (click)="viewTraineeLectureDetail(course)">
                <mat-icon>visibility</mat-icon>
                Chi tiết
              </button>
              
              <!-- Action buttons based on status -->
              <button mat-raised-button
                      color="primary"
                      *ngIf="canStartLearning(course)"
                      (click)="startLearning(course)">
                <mat-icon>play_arrow</mat-icon>
                Bắt đầu học
              </button>
              
              <button mat-raised-button
                      color="accent"
                      *ngIf="canContinueLearning(course)"
                      (click)="continueLearning(course)">
                <mat-icon>play_arrow</mat-icon>
                Tiếp tục học
              </button>
              
              <button mat-raised-button
                      color="warn"
                      *ngIf="canStartExam(course)"
                      (click)="startExam(course)">
                <mat-icon>quiz</mat-icon>
                {{ course.statusLearn === 3 ? 'Tiếp tục thi' : 'Bắt đầu thi' }}
              </button>
              
              <button mat-raised-button
                      color="primary"
                      *ngIf="isCompleted(course)"
                      (click)="viewCertificate(course)">
                <mat-icon>workspace_premium</mat-icon>
                Chứng chỉ
              </button>
            </div>
          </mat-card-actions>
        </mat-card>
      </div>

      <!-- Empty state -->
      <div class="empty-state" *ngIf="myCourses.length === 0 && !loading">
        <mat-icon>person_off</mat-icon>
        <h3>Chưa có khóa học nào</h3>
        <p *ngIf="searchTitle || selectedStatusLearn">
          Không tìm thấy khóa học nào phù hợp với bộ lọc
        </p>
        <p *ngIf="!searchTitle && !selectedStatusLearn">
          Bạn chưa đăng ký khóa học nào
        </p>
        <button mat-raised-button 
                color="primary" 
                (click)="clearFilters()"
                *ngIf="searchTitle || selectedStatusLearn">
          <mat-icon>clear</mat-icon>
          Xóa bộ lọc
        </button>
      </div>

      <!-- Pagination -->
      <div class="pagination-section" *ngIf="totalItems > pageSize">
        <mat-paginator 
          [length]="totalItems"
          [pageSize]="pageSize"
          [pageSizeOptions]="[5, 10, 25, 50]"
          [pageIndex]="currentPage - 1"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>

      <!-- Error display -->
      <div class="error-section" *ngIf="error">
        <mat-card class="error-card">
          <mat-card-content>
            <div class="error-content">
              <mat-icon color="warn">error</mat-icon>
              <p>{{ error }}</p>
              <button mat-raised-button color="primary" (click)="clearError()">
                <mat-icon>close</mat-icon>
                Đóng
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>
