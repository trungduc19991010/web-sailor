<!-- Trang danh sách khóa học -->
<div class="course-list-container">
  <!-- Header -->
  <div class="course-header">
    <div class="container">
      <div class="header-content">
        <div class="header-text">
          <h1>
            <mat-icon>school</mat-icon>
            Khóa học của tôi
          </h1>
          <p>Quản lý tiến độ học tập và hoàn thành khóa học</p>
        </div>
        <div class="header-actions">
          <button mat-raised-button 
                  color="primary" 
                  (click)="refreshCourses()"
                  [disabled]="loading">
            <mat-icon>refresh</mat-icon>
            Làm mới
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- Loading spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Đang tải danh sách khóa học...</p>
  </div>

  <!-- Main content -->
  <div class="course-content" *ngIf="!loading">
    <div class="container">
      
      <!-- Modern Filters Section with Tailwind -->
      <div class="mb-6">
        <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
          <!-- Filter Header -->
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-3">
            <div class="flex items-center gap-2">
              <div class="flex items-center justify-center w-8 h-8 bg-white/20 rounded-lg">
                <mat-icon class="!text-lg !w-5 !h-5" style="color: white !important;">filter_list</mat-icon>
              </div>
              <div>
                <h3 class="text-white text-base font-semibold mb-0">Bộ lọc tìm kiếm</h3>
                <p class="text-blue-100 text-xs mb-0">Lọc và tìm kiếm khóa học phù hợp</p>
              </div>
            </div>
          </div>
          
          <!-- Filter Content -->
          <div class="p-4 md:p-6">
            <!-- Main Filter Row -->
            <div class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
              
              <!-- Search Input -->
              <div class="col-span-1 md:col-span-5">
                <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                  <mat-icon class="!text-base !w-4 !h-4 mr-1 text-gray-500">search</mat-icon>
                  <span>Tìm kiếm theo tên</span>
                </label>
                <mat-form-field appearance="outline" class="w-full">
                  <input matInput 
                         [(ngModel)]="searchTitle"
                         (keyup.enter)="applyFilters()"
                         placeholder="Nhập tên khóa học..."
                         class="text-sm">
                  <mat-icon matSuffix class="text-gray-400">search</mat-icon>
                </mat-form-field>
              </div>

              <!-- Status Filter -->
              <div class="col-span-1 md:col-span-4">
                <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                  <mat-icon class="!text-base !w-4 !h-4 mr-1 text-gray-500">assignment</mat-icon>
                  <span>Trạng thái học</span>
                </label>
                <mat-form-field appearance="outline" class="w-full">
                  <mat-select [(ngModel)]="selectedStatusLearn" 
                             (ngModelChange)="applyFilters()"
                             class="text-sm">
                    <mat-option *ngFor="let option of statusLearnOptions" [value]="option.value">
                      {{ option.label }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <!-- Action Buttons -->
              <div class="col-span-1 md:col-span-3 flex flex-row gap-2" style="margin: 28px 0px;">
                <button 
                  mat-raised-button 
                  color="primary"
                  (click)="applyFilters()"
                  class="flex-1 !h-14">
                  <mat-icon class="!text-base !w-4 !h-4">search</mat-icon>
                  <span class="ml-1">Áp dụng</span>
                </button>
                
                <button 
                  mat-stroked-button 
                  (click)="clearFilters()"
                  [disabled]="!searchTitle && selectedStatusLearn === ''"
                  class="flex-1 !h-14">
                  <mat-icon class="!text-base !w-4 !h-4">clear</mat-icon>
                  <span class="ml-1">Xóa</span>
                </button>
              </div>
            </div>
            
            <!-- Quick Filter Chips (Horizontal) -->
            <div class="mt-3 pt-3 border-t border-gray-200">
              <label class="flex items-center text-xs font-medium text-gray-600 mb-2">
                <mat-icon class="!text-sm !w-4 !h-4 mr-1 text-gray-500">flash_on</mat-icon>
                <span>Lọc nhanh:</span>
              </label>
              
              <div class="flex flex-wrap gap-2">
                <!-- Chưa học -->
                <button 
                  mat-stroked-button
                  (click)="quickFilter('created')"
                  [class.bg-gray-100]="selectedStatusLearn === 0"
                  [class.border-gray-400]="selectedStatusLearn === 0"
                  [class.text-gray-800]="selectedStatusLearn === 0"
                  class="!text-xs !py-1 !px-3 !min-h-0 !h-8 transition-all hover:bg-gray-50">
                  <mat-icon class="!text-sm !w-4 !h-4 mr-1">fiber_new</mat-icon>
                  <span>Chưa học</span>
                </button>
                
                <!-- Đang học -->
                <button 
                  mat-stroked-button
                  (click)="quickFilter('in-progress')"
                  [class.bg-blue-50]="selectedStatusLearn === 1"
                  [class.border-blue-400]="selectedStatusLearn === 1"
                  [class.text-blue-700]="selectedStatusLearn === 1"
                  class="!text-xs !py-1 !px-3 !min-h-0 !h-8 transition-all hover:bg-blue-50">
                  <mat-icon class="!text-sm !w-4 !h-4 mr-1">play_arrow</mat-icon>
                  <span>Đang học</span>
                </button>
                
                <!-- Hoàn thành học -->
                <button 
                  mat-stroked-button
                  (click)="quickFilter('completed-learn')"
                  [class.bg-green-50]="selectedStatusLearn === 2"
                  [class.border-green-400]="selectedStatusLearn === 2"
                  [class.text-green-700]="selectedStatusLearn === 2"
                  class="!text-xs !py-1 !px-3 !min-h-0 !h-8 transition-all hover:bg-green-50">
                  <mat-icon class="!text-sm !w-4 !h-4 mr-1">school</mat-icon>
                  <span>Hoàn thành học</span>
                </button>
                
                <!-- Đang thi -->
                <button 
                  mat-stroked-button
                  (click)="quickFilter('in-exam')"
                  [class.bg-orange-50]="selectedStatusLearn === 3"
                  [class.border-orange-400]="selectedStatusLearn === 3"
                  [class.text-orange-700]="selectedStatusLearn === 3"
                  class="!text-xs !py-1 !px-3 !min-h-0 !h-8 transition-all hover:bg-orange-50">
                  <mat-icon class="!text-sm !w-4 !h-4 mr-1">quiz</mat-icon>
                  <span>Đang thi</span>
                </button>
                
                <!-- Hoàn thành thi -->
                <button 
                  mat-stroked-button
                  (click)="quickFilter('completed-exam')"
                  [class.bg-purple-50]="selectedStatusLearn === 4"
                  [class.border-purple-400]="selectedStatusLearn === 4"
                  [class.text-purple-700]="selectedStatusLearn === 4"
                  class="!text-xs !py-1 !px-3 !min-h-0 !h-8 transition-all hover:bg-purple-50">
                  <mat-icon class="!text-sm !w-4 !h-4 mr-1">workspace_premium</mat-icon>
                  <span>Hoàn thành thi</span>
                </button>
              </div>
            </div>
            
            <!-- Active Filters Display -->
            <div class="mt-3 pt-3 border-t border-gray-200" *ngIf="searchTitle || (selectedStatusLearn !== '' && selectedStatusLearn !== undefined)">
              <div class="flex items-center gap-2 flex-wrap">
                <span class="flex items-center text-xs font-medium text-gray-600">
                  <mat-icon class="!text-sm !w-4 !h-4 mr-1">local_offer</mat-icon>
                  <span>Đang áp dụng:</span>
                </span>
                
                <!-- Search filter tag -->
                <div *ngIf="searchTitle" class="flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs border border-blue-200">
                  <mat-icon class="!text-sm !w-3 !h-3">search</mat-icon>
                  <span class="font-medium">"{{ searchTitle }}"</span>
                  <button mat-icon-button (click)="clearSearchTitle()" class="!w-4 !h-4 !p-0 text-blue-600 hover:text-blue-800">
                    <mat-icon class="!text-xs !w-3 !h-3">close</mat-icon>
                  </button>
                </div>
                
                <!-- Status filter tag -->
                <div *ngIf="selectedStatusLearn !== '' && selectedStatusLearn !== undefined" class="flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs border border-green-200">
                  <mat-icon class="!text-sm !w-3 !h-3">assignment</mat-icon>
                  <span class="font-medium">{{ getStatusLearnDisplayText(selectedStatusLearn) }}</span>
                  <button mat-icon-button (click)="clearStatusLearn()" class="!w-4 !h-4 !p-0 text-green-600 hover:text-green-800">
                    <mat-icon class="!text-xs !w-3 !h-3">close</mat-icon>
                  </button>
                </div>
                
                <!-- Clear all button -->
                <button 
                  mat-button 
                  (click)="clearFilters()"
                  class="!text-xs text-red-600 hover:text-red-800 hover:bg-red-50 !px-2 !py-1 !min-h-0 !h-6 rounded">
                  <mat-icon class="!text-sm !w-4 !h-4 mr-1">clear_all</mat-icon>
                  <span>Xóa tất cả</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modern Results Summary -->
      <div class="mb-6" *ngIf="myCourses.length > 0">
        <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg px-4 py-3 border-l-4 border-blue-500">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full">
                <mat-icon class="text-blue-600 text-lg">inventory</mat-icon>
              </div>
              <div>
                <p class="text-sm font-semibold text-gray-800 mb-0">
                  Hiển thị 
                  <span class="text-blue-600 font-bold">{{ myCourses.length }}</span> 
                  khóa học
                  <span *ngIf="searchTitle || selectedStatusLearn" class="text-orange-600 font-medium">
                    (có bộ lọc)
                  </span>
                </p>
                <p class="text-xs text-gray-600 mb-0" *ngIf="totalItems > myCourses.length">
                  Trang {{ currentPage }} / {{ Math.ceil(totalItems / pageSize) }} • Tổng cộng {{ totalItems }} khóa học
                </p>
              </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="flex items-center gap-3 text-xs">
              <!-- Chưa học -->
              <div class="text-center" *ngIf="getStatusCounts().created > 0">
                <div class="text-sm font-bold text-gray-600">{{ getStatusCounts().created }}</div>
                <div class="text-xs text-gray-500">Chưa học</div>
              </div>
              
              <!-- Đang học -->
              <div class="text-center" *ngIf="getStatusCounts().inProgressLearn > 0">
                <div class="text-sm font-bold text-blue-600">{{ getStatusCounts().inProgressLearn }}</div>
                <div class="text-xs text-gray-500">Đang học</div>
              </div>
              
              <!-- Hoàn thành học -->
              <div class="text-center" *ngIf="getStatusCounts().completedLearn > 0">
                <div class="text-sm font-bold text-green-600">{{ getStatusCounts().completedLearn }}</div>
                <div class="text-xs text-gray-500">Hoàn thành học</div>
              </div>
              
              <!-- Đang thi -->
              <div class="text-center" *ngIf="getStatusCounts().inProgressExam > 0">
                <div class="text-sm font-bold text-orange-600">{{ getStatusCounts().inProgressExam }}</div>
                <div class="text-xs text-gray-500">Đang thi</div>
              </div>
              
              <!-- Hoàn thành thi -->
              <div class="text-center" *ngIf="getStatusCounts().completedExam > 0">
                <div class="text-sm font-bold text-purple-600">{{ getStatusCounts().completedExam }}</div>
                <div class="text-xs text-gray-500">Hoàn thành thi</div>
              </div>
              
              <!-- Separator -->
              <div class="w-px h-8 bg-gray-300 mx-2" *ngIf="myCourses.length > 0"></div>
              
              <!-- Total Summary -->
              <div class="text-center">
                <div class="text-sm font-bold text-gray-800">{{ myCourses.length }}</div>
                <div class="text-xs text-gray-500">Tổng cộng</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- My Courses grid (TraineeLecture) -->
      <div class="courses-grid" *ngIf="myCourses.length > 0">
        <mat-card class="course-card trainee-lecture-card" 
                  *ngFor="let course of myCourses; trackBy: trackByTraineeLectureId">
          
          <!-- Course image -->
          <div class="course-image">
            <img src="assets/images/default-course.jpg" 
                 [alt]="course.title"
                 class="course-thumbnail">
            
            <!-- Status badge overlay -->
            <div class="status-learn-badge" 
                 [style.background-color]="getStatusLearnColor(course.statusLearn)">
              {{ getStatusLearnDisplayText(course.statusLearn) }}
            </div>
            
            <!-- Course code badge -->
            <div class="course-code-badge">
              {{ course.courseCode }}
            </div>
          </div>
          
          <mat-card-header>
            <mat-card-title [title]="course.title">{{ course.title }}</mat-card-title>
            <mat-card-subtitle>
              <div class="course-meta">
                <span class="course-name" [title]="course.courseName">
                  <mat-icon>school</mat-icon>
                  {{ course.courseName }}
                </span>
                <span class="created-date">
                  <mat-icon>schedule</mat-icon>
                  {{ formatDate(course.created) }}
                </span>
              </div>
            </mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="course-description-wrapper">
              <p class="course-description" [title]="course.description">{{ course.description }}</p>
            </div>
            
            <!-- Course info grid -->
            <div class="course-info-grid">
              <!-- Course objects -->
              <div class="info-item" *ngIf="course.objects">
                <div class="info-label">
                  <mat-icon>flag</mat-icon>
                  <strong>Mục tiêu:</strong>
                </div>
                <p class="info-content" [title]="course.objects">{{ course.objects }}</p>
              </div>
              
              <!-- Note -->
              <div class="info-item" *ngIf="course.note">
                <div class="info-label">
                  <mat-icon>note</mat-icon>
                  <strong>Ghi chú:</strong>
                </div>
                <p class="info-content" [title]="course.note">{{ course.note }}</p>
              </div>
              
              <!-- Registration status -->
              <div class="info-item registration-status">
                <div class="info-label">
                  <mat-icon>person_check</mat-icon>
                  <strong>Trạng thái:</strong>
                </div>
                <div class="registration-badge" [class.registered]="course.isRegistered">
                  <mat-icon [style.color]="course.isRegistered ? '#4caf50' : '#f44336'">
                    {{ course.isRegistered ? 'check_circle' : 'cancel' }}
                  </mat-icon>
                  <span>{{ course.isRegistered ? 'Đã đăng ký' : 'Chưa đăng ký' }}</span>
                </div>
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <div class="card-actions">
              
              <!-- Action buttons based on status -->
              <button mat-raised-button
                      color="primary"
                      *ngIf="canStartLearning(course)"
                      (click)="startLearning(course)">
                <mat-icon>play_arrow</mat-icon>
                Bắt đầu học
              </button>
              
              <button mat-raised-button
                      color="accent"
                      *ngIf="canContinueLearning(course)"
                      (click)="continueLearning(course)">
                <mat-icon>play_arrow</mat-icon>
                Tiếp tục học
              </button>

              <button mat-raised-button
                      color="warn"
                      *ngIf="canRelearn(course)"
                      (click)="continueLearning(course)">
                <mat-icon>replay</mat-icon>
                {{ 'Học lại' }}
              </button>
              
              <button mat-raised-button
                      color="warn"
                      *ngIf="canStartExam(course)"
                      (click)="startExam(course)">
                <mat-icon>{{ getExamButtonIcon(course) }}</mat-icon>
                {{ getExamButtonText(course) }}
              </button>
              
              <button mat-raised-button
                      color="primary"
                      *ngIf="isCompleted(course)"
                      (click)="viewCertificate(course)">
                <mat-icon>workspace_premium</mat-icon>
                Chứng chỉ
              </button>
            </div>
          </mat-card-actions>
        </mat-card>
      </div>

      <!-- Modern Empty State -->
      <div class="flex flex-col items-center justify-center py-16 px-4" *ngIf="myCourses.length === 0">
        <div class="text-center max-w-md">
          <!-- Empty Icon -->
          <div class="flex items-center justify-center w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full">
            <mat-icon class="text-gray-400" style="width:24px !important; height: 24px !important" *ngIf="!searchTitle && !selectedStatusLearn">school_off</mat-icon>
            <mat-icon class="text-orange-400" style="width:24px !important; height: 24px !important" *ngIf="searchTitle || selectedStatusLearn">search_off</mat-icon>
          </div>
          
          <!-- Empty Title -->
          <h3 class="text-xl font-semibold text-gray-800 mb-3" *ngIf="!searchTitle && !selectedStatusLearn">
            Chưa có khóa học nào
          </h3>
          <h3 class="text-xl font-semibold text-gray-800 mb-3" *ngIf="searchTitle || selectedStatusLearn">
            Không tìm thấy kết quả
          </h3>
          
          <!-- Empty Description -->
          <div class="text-gray-600 mb-6 space-y-2">
            <p *ngIf="!searchTitle && !selectedStatusLearn">
              Bạn chưa đăng ký khóa học nào. 
              <br>Hãy liên hệ quản trị viên để đăng ký khóa học mới.
            </p>
            <p *ngIf="searchTitle || selectedStatusLearn">
              Không tìm thấy khóa học nào phù hợp với bộ lọc hiện tại.
              <br>Hãy thử thay đổi điều kiện lọc hoặc xóa bộ lọc.
            </p>
          </div>
          
          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <!-- Clear Filters Button -->
            <button 
              mat-raised-button 
              color="primary" 
              (click)="clearFilters()"
              *ngIf="searchTitle || selectedStatusLearn"
              class="px-6 py-2">
              <mat-icon class="mr-2">clear_all</mat-icon>
              Xóa bộ lọc
            </button>
            
            <!-- Refresh Button -->
            <button 
              mat-stroked-button 
              color="primary" 
              (click)="refreshCourses()"
              class="px-6 py-2">
              <mat-icon class="mr-2">refresh</mat-icon>
              Làm mới
            </button>
          </div>
          
          <!-- Helpful Tips -->
          <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h4 class="text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2">
              <mat-icon class="text-blue-600 text-base">lightbulb</mat-icon>
              Gợi ý
            </h4>
            <ul class="text-sm text-blue-700 space-y-1">
              <li *ngIf="!searchTitle && !selectedStatusLearn">• Liên hệ quản trị viên để đăng ký khóa học</li>
              <li *ngIf="searchTitle || selectedStatusLearn">• Thử sử dụng từ khóa khác hoặc bỏ chọn trạng thái</li>
              <li>• Sử dụng nút "Làm mới" để cập nhật danh sách</li>
              <li>• Kiểm tra kết nối mạng và thử lại</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-section" *ngIf="totalItems > pageSize">
        <mat-paginator 
          [length]="totalItems"
          [pageSize]="pageSize"
          [pageSizeOptions]="[5, 10, 25, 50]"
          [pageIndex]="currentPage - 1"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>

      <!-- Error display -->
      <div class="error-section" *ngIf="error">
        <mat-card class="error-card">
          <mat-card-content>
            <div class="error-content">
              <mat-icon color="warn">error</mat-icon>
              <p>{{ error }}</p>
              <button mat-raised-button color="primary" (click)="clearError()">
                <mat-icon>close</mat-icon>
                Đóng
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>
