<!-- Course Enrollment Dialog -->
<div class="enrollment-dialog">
  <!-- Dialog Header -->
  <div class="dialog-header">
    <h2>
      <mat-icon>school</mat-icon>
      Đăng ký khóa học
    </h2>
    <button mat-icon-button 
            class="close-button" 
            (click)="onCancel()"
            matTooltip="Đóng">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Course Information -->
  <div class="course-info-section">
    <div class="course-summary">
      <div class="course-image">
        <img [src]="course.imageUrl || 'assets/images/default-course.jpg'" 
             [alt]="course.title"
             onerror="this.src='assets/images/default-course.jpg'">
      </div>
      
      <div class="course-details">
        <h3>{{ course.title }}</h3>
        <div class="course-meta">
          <div class="meta-item">
            <mat-icon>person</mat-icon>
            <span>{{ course.instructor }}</span>
          </div>
          <div class="meta-item">
            <mat-icon>schedule</mat-icon>
            <span>{{ formatDuration(course.duration) }}</span>
          </div>
          <div class="meta-item">
            <mat-icon>category</mat-icon>
            <span>{{ course.category }}</span>
          </div>
        </div>
        
        <div class="price-info">
          <span class="price">{{ formatPrice(course.price) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Enrollment Form -->
  <div class="enrollment-form-section">
    <form [formGroup]="enrollmentForm" (ngSubmit)="onSubmit()">
      
      <!-- User Status Info -->
      <div class="user-status" *ngIf="isLoggedIn">
        <div class="status-info">
          <mat-icon>check_circle</mat-icon>
          <span>Bạn đã đăng nhập. Thông tin sẽ được tự động điền từ tài khoản của bạn.</span>
        </div>
      </div>

      <div class="user-status" *ngIf="!isLoggedIn">
        <div class="status-warning">
          <mat-icon>info</mat-icon>
          <span>Bạn chưa đăng nhập. Vui lòng điền đầy đủ thông tin để đăng ký khóa học.</span>
        </div>
      </div>

      <!-- Form Fields -->
      <div class="form-grid">
        
        <!-- Full Name -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Họ và tên *</mat-label>
          <input matInput 
                 formControlName="fullName"
                 placeholder="Nhập họ và tên đầy đủ">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="hasError('fullName')">
            {{ getErrorMessage('fullName') }}
          </mat-error>
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email *</mat-label>
          <input matInput 
                 type="email"
                 formControlName="email"
                 placeholder="example@email.com">
          <mat-icon matSuffix>email</mat-icon>
          <mat-error *ngIf="hasError('email')">
            {{ getErrorMessage('email') }}
          </mat-error>
        </mat-form-field>

        <!-- Phone Number -->
        <mat-form-field appearance="outline">
          <mat-label>Số điện thoại *</mat-label>
          <input matInput 
                 formControlName="phoneNumber"
                 placeholder="0123456789">
          <mat-icon matSuffix>phone</mat-icon>
          <mat-error *ngIf="hasError('phoneNumber')">
            {{ getErrorMessage('phoneNumber') }}
          </mat-error>
        </mat-form-field>

        <!-- ID Number -->
        <mat-form-field appearance="outline">
          <mat-label>CCCD/CMND *</mat-label>
          <input matInput 
                 formControlName="idNumber"
                 placeholder="123456789">
          <mat-icon matSuffix>badge</mat-icon>
          <mat-error *ngIf="hasError('idNumber')">
            {{ getErrorMessage('idNumber') }}
          </mat-error>
        </mat-form-field>

        <!-- Date of Birth -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ngày sinh *</mat-label>
          <input matInput 
                 [matDatepicker]="picker"
                 formControlName="dateOfBirth"
                 placeholder="Chọn ngày sinh"
                 (blur)="validateDateOfBirth()">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="hasError('dateOfBirth')">
            {{ getDateOfBirthErrorMessage() }}
          </mat-error>
        </mat-form-field>

        <!-- Address -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Địa chỉ *</mat-label>
          <textarea matInput 
                    formControlName="address"
                    placeholder="Nhập địa chỉ đầy đủ"
                    rows="3">
          </textarea>
          <mat-icon matSuffix>location_on</mat-icon>
          <mat-error *ngIf="hasError('address')">
            {{ getErrorMessage('address') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Terms and Conditions -->
      <div class="terms-section">
        <div class="terms-info">
          <mat-icon>info_outline</mat-icon>
          <div class="terms-text">
            <p>Bằng việc đăng ký khóa học, bạn đồng ý với:</p>
            <ul>
              <li>Điều khoản và điều kiện sử dụng dịch vụ</li>
              <li>Chính sách bảo mật thông tin cá nhân</li>
              <li>Quy định về thanh toán và hoàn tiền</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="dialog-actions">
        <button mat-button 
                type="button"
                (click)="onCancel()"
                [disabled]="loading">
          Hủy bỏ
        </button>
        
        <button mat-raised-button 
                color="primary"
                type="submit"
                [disabled]="enrollmentForm.invalid || loading">
          <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
          <mat-icon *ngIf="!loading">school</mat-icon>
          {{ loading ? 'Đang xử lý...' : 'Đăng ký ngay' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Additional Information -->
  <div class="additional-info" *ngIf="!loading">
    <div class="info-cards">
      <div class="info-card">
        <mat-icon>support_agent</mat-icon>
        <div class="info-content">
          <h4>Hỗ trợ 24/7</h4>
          <p>Đội ngũ hỗ trợ sẵn sàng giúp đỡ bạn</p>
        </div>
      </div>
      
      <div class="info-card">
        <mat-icon>verified</mat-icon>
        <div class="info-content">
          <h4>Chứng chỉ</h4>
          <p>Nhận chứng chỉ sau khi hoàn thành</p>
        </div>
      </div>
      
      <div class="info-card">
        <mat-icon>access_time</mat-icon>
        <div class="info-content">
          <h4>Học linh hoạt</h4>
          <p>Học mọi lúc, mọi nơi theo lịch trình của bạn</p>
        </div>
      </div>
    </div>
  </div>
</div>
